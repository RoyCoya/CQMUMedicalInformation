{% extends 'BoneAge/base.html' %}

{% block title_BoneAge %}Dicom数据库{% endblock title_BoneAge %}

{% block nav_BoneAge_library %}active{% endblock %}

{% block css_BoneAge %}
{% endblock css_BoneAge %}

{% block content_BoneAge %}
{% load static %}

<div class="row mt-5">
    <div class="col-6 border-end">
        <h2 class="text-center">已完成任务 {{finished_tasks|length}}</h2>
        {% if finished_tasks %}
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>患者（ID）</th>
                        <th>性别</th>
                        <th>任务ID</th>
                        <th>检查日期</th>
                        <th>分配给</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in finished_tasks %}
                        <tr id="{{task.id}}">
                            <td>{{task.dcm_file.patient.name}}（{{task.dcm_file.patient.Patient_ID}}）</td>
                            <td>{{task.dcm_file.patient.get_sex_display}}</td>
                            <td>{{task.id}}</td>
                            {% if task.dcm_file.Study_Date %}
                                <td>{{task.dcm_file.Study_Date}}</td>
                            {% else %}
                                <td><span class="text-danger">读取失败</span></td>
                            {% endif %}
                            <td>{{task.allocated_to.last_name}}{{task.allocated_to.first_name}}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            暂无任务。
        {% endif %}
    </div>
    <div class="col-6">
        <h2 class="text-center text-success">未完结任务 {{unfinished_tasks|length}}</h2>
        {% if unfinished_tasks %}
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>患者（ID）</th>
                        <th>性别</th>
                        <th>dcm ID</th>
                        <th>检查日期</th>
                        <th>分配给</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in unfinished_tasks %}
                        <tr id="{{task.id}}">
                            <td>{{task.dcm_file.patient.name}}（{{task.dcm_file.patient.Patient_ID}}）</td>
                            <td>{{task.dcm_file.patient.get_sex_display}}</td>
                            <td>{{task.id}}</td>
                            {% if task.dcm_file.Study_Date %}
                                <td>{{task.dcm_file.Study_Date}}</td>
                            {% else %}
                                <td><span class="text-danger">读取失败</span></td>
                            {% endif %}
                            <td>{{task.allocated_to.last_name}}{{task.allocated_to.first_name}}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            暂无任务。
        {% endif %}
    </div>
</div>

{% endblock content_BoneAge %}
{% block js_BoneAge %}
<script src="{% static 'BoneAge/js/dcm_library/library.js' %}"></script>
{% endblock js_BoneAge %}